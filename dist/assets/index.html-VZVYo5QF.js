import{r as h,j as e,a as y,c as T}from"./globals-DmyaZ-jK.js";import{d as _,u as C,g as w,T as S,a as A,e as P,f as B,b as I,c as L,S as E}from"./Toast-Dg8RW9Rk.js";const N="src/newtab/index.html",j=30;function R(){var p;const{session:a,loading:x}=_(),n=C(),c=w(n.locale),r=(p=a==null?void 0:a.user)==null?void 0:p.id,[l,i]=h.useState("authenticator"),o=h.useCallback(t=>{const s=t?chrome.runtime.getURL(N)+t:chrome.runtime.getURL(N);chrome.tabs.create({url:s})},[]),f=h.useCallback(()=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{const s=t[0];if(s!=null&&s.url&&!s.url.startsWith("chrome://")){const d=new URLSearchParams({add:"1",url:s.url,title:s.title??""});o("?"+d.toString())}})},[o]),u=h.useCallback(()=>{var t,s;(s=(t=chrome.runtime).openOptionsPage)==null||s.call(t)},[]);if(x){const t=w(n.locale);return e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-[#151b28]",children:e.jsx(S,{message:t.loadingAuth,type:"info",open:!0,onClose:()=>{}})})}return e.jsxs("div",{className:"w-[360px] h-[500px] bg-[#151b28] rounded-xl shadow-2xl border border-white/5 overflow-hidden flex flex-col font-display",children:[e.jsxs("header",{className:"flex items-center justify-between px-4 py-3 bg-[#151b28]/95 backdrop-blur-sm border-b border-white/5 z-20 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-7 h-7 bg-[#256af4] rounded-lg flex items-center justify-center shadow-lg shadow-blue-900/20",children:e.jsx("span",{className:"material-symbols-outlined text-white text-[18px]",children:"hub"})}),e.jsx("h1",{className:"text-white text-base font-bold tracking-tight",children:"LinkHub"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>o(),className:"w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white rounded-lg hover:bg-white/5 transition-all","aria-label":c.settings,children:e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"search"})}),e.jsx("button",{type:"button",onClick:u,className:"w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white rounded-lg hover:bg-white/5 transition-all","aria-label":c.settings,children:e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"settings"})})]})]}),e.jsx("nav",{className:"flex items-center bg-[#151b28] border-b border-white/5 z-10 shrink-0",children:[{id:"authenticator",icon:"lock",label:"Authenticator"},{id:"bookmarks",icon:"bookmarks",label:"Bookmarks"},{id:"it-tools",icon:"terminal",label:"IT Tools"}].map(t=>e.jsxs("button",{type:"button",onClick:()=>i(t.id),className:`flex-1 py-2.5 flex flex-col items-center justify-center gap-0.5 transition-colors group relative ${l===t.id?"text-[#256af4] bg-white/[0.02]":"text-gray-500 hover:text-gray-300 hover:bg-white/5"}`,children:[e.jsx("span",{className:`material-symbols-outlined text-[20px] transition-transform ${l===t.id?"material-symbols-filled":"group-hover:-translate-y-0.5"}`,children:t.icon}),e.jsx("span",{className:"text-[10px] font-medium tracking-wide",children:t.label}),l===t.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#256af4] shadow-[0_-2px_6px_rgba(37,106,244,0.4)]"})]},t.id))}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-2 pt-2 pb-20 relative min-h-0",children:[l==="authenticator"&&e.jsx(H,{userId:r,openNewTab:o,t:c}),l==="bookmarks"&&e.jsx(U,{userId:r,openNewTab:o,addCurrentPage:f,t:c}),l==="it-tools"&&e.jsx(M,{openNewTab:o,t:c})]})]})}function U({userId:a,openNewTab:x,addCurrentPage:n,t:c}){var t;const{boards:r,loading:l}=P(a),[i,o]=y.useState(null),f=i??((t=r[0])==null?void 0:t.id)??null,{categories:u,loading:p}=B(f);return y.useEffect(()=>{var s,d,g;if(a)try{if(typeof chrome<"u"&&((s=chrome.storage)!=null&&s.local))chrome.storage.local.get(["lastSelectedBoardId"],m=>{var v;const b=m.lastSelectedBoardId;b&&r.some(k=>k.id===b)?o(b):(v=r[0])!=null&&v.id&&o(r[0].id)});else if(typeof window<"u"){const m=window.localStorage.getItem("lastSelectedBoardId");m&&r.some(b=>b.id===m)?o(m):(d=r[0])!=null&&d.id&&o(r[0].id)}}catch{!i&&((g=r[0])!=null&&g.id)&&o(r[0].id)}},[a,r,i]),a?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2 px-1 pb-2",children:[e.jsx("button",{type:"button",onClick:()=>x(),className:"flex-1 py-2 px-3 rounded-lg bg-[#256af4] text-white text-xs font-medium hover:bg-blue-600 shadow-[0_0_20px_-5px_rgba(37,106,244,0.5)]",children:"Mở trang Dấu trang"}),e.jsx("button",{type:"button",onClick:n,className:"flex-1 py-2 px-3 rounded-lg border border-white/10 text-[#90a4cb] text-xs font-medium hover:bg-white/5 hover:text-white",children:"Thêm trang này"})]}),l||p?e.jsx("p",{className:"text-[#90a4cb] text-sm py-4",children:"Đang tải..."}):u.length===0?e.jsx("p",{className:"text-[#90a4cb] text-sm py-4",children:"Chưa có category. Mở LinkHub để thêm."}):e.jsx("div",{className:"space-y-4",children:u.map(s=>e.jsxs("section",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 sticky top-0 bg-[#151b28]/95 backdrop-blur-sm z-10",children:[e.jsx("span",{className:"material-symbols-outlined text-[16px] text-[#256af4]",children:"folder"}),e.jsx("h3",{className:"text-[#90a4cb] text-xs font-semibold uppercase tracking-wider truncate",children:s.name||"Unnamed"})]}),(s.bookmarks??[]).length===0?e.jsx("p",{className:"text-[#64748b] text-[11px] px-3 py-1",children:"Trống"}):e.jsx("div",{className:"space-y-0.5",children:(s.bookmarks??[]).map(d=>e.jsxs("a",{href:d.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 rounded-xl hover:bg-[#1e2532] transition-colors border border-transparent hover:border-white/5 group",onClick:g=>{g.preventDefault(),chrome.tabs.create({url:d.url})},children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-white font-semibold text-sm truncate block",children:d.title||"Untitled"}),e.jsx("span",{className:"text-[#90a4cb] text-[11px] truncate block",children:new URL(d.url).hostname})]}),e.jsx("span",{className:"material-symbols-outlined text-[18px] text-gray-500 group-hover:text-[#256af4]",children:"open_in_new"})]},d.id))})]},s.id))})]}):e.jsxs("div",{className:"py-6 px-3 text-center",children:[e.jsx("p",{className:"text-[#90a4cb] text-sm mb-4",children:"Đăng nhập để xem bookmark."}),e.jsx("button",{type:"button",onClick:()=>x(),className:"py-2 px-4 rounded-lg bg-[#256af4] text-white text-sm font-medium hover:bg-blue-600",children:"Mở LinkHub"})]})}function M({openNewTab:a,t:x}){return e.jsxs("div",{className:"py-6 px-3 text-center",children:[e.jsx("p",{className:"text-[#90a4cb] text-sm mb-4",children:"Mở trang LinkHub để sử dụng IT Tools (JSON, Base64, Hash, ...)."}),e.jsx("button",{type:"button",onClick:()=>a("?open=it-tools"),className:"py-2.5 px-5 rounded-lg bg-[#256af4] text-white text-sm font-medium hover:bg-blue-600 shadow-[0_0_20px_-5px_rgba(37,106,244,0.5)]",children:"Mở IT Tools"})]})}function H({userId:a,openNewTab:x,t:n}){const{entries:c,loading:r}=A(a),[,l]=h.useState(0);return h.useEffect(()=>{const i=setInterval(()=>l(o=>o+1),1e3);return()=>clearInterval(i)},[]),a?r?e.jsx("p",{className:"text-[#90a4cb] text-sm py-6 px-3",children:"Đang tải..."}):c.length===0?e.jsxs("div",{className:"py-6 px-3 text-center",children:[e.jsx("p",{className:"text-[#90a4cb] text-sm mb-4",children:n.noAccountsYet}),e.jsx("button",{type:"button",onClick:()=>x("?open=authenticator"),className:"py-2.5 px-5 rounded-lg bg-[#256af4] text-white text-sm font-medium hover:bg-blue-600 shadow-[0_0_20px_-5px_rgba(37,106,244,0.5)]",children:n.addAccount})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-1 pb-2",children:c.slice(0,20).map(i=>e.jsx($,{entry:i,t:n},i.id))}),e.jsx("div",{className:"absolute bottom-5 right-5 z-20",children:e.jsx("button",{type:"button",onClick:()=>x("?open=authenticator"),className:"w-12 h-12 bg-[#256af4] rounded-full shadow-[0_0_20px_-5px_rgba(37,106,244,0.5)] flex items-center justify-center text-white hover:bg-blue-600 active:scale-95 transition-all group","aria-label":n.addAccount,children:e.jsx("span",{className:"material-symbols-outlined text-[24px] group-hover:rotate-90 transition-transform duration-300",children:"add"})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-[#151b28] to-transparent pointer-events-none z-10","aria-hidden":!0})]}):e.jsxs("div",{className:"py-6 px-3 text-center",children:[e.jsx("p",{className:"text-[#90a4cb] text-sm mb-4",children:n.loginToUseAuthenticator}),e.jsx("button",{type:"button",onClick:()=>x(),className:"py-2 px-4 rounded-lg bg-[#256af4] text-white text-sm font-medium hover:bg-blue-600",children:"Đăng nhập"})]})}function $({entry:a,t:x}){const[n,c]=h.useState("------"),[r,l]=h.useState(!1),i=L(j),o=i/j*100,f=i<=5,u=8.5,p=2*Math.PI*u,t=p-o/100*p;h.useEffect(()=>{let m=!1;return I(a.secret,j).then(b=>{m||c(b)}).catch(()=>{m||c("------")}),()=>{m=!0}},[a.secret,i]);const s=()=>{n!=="------"&&(navigator.clipboard.writeText(n),l(!0),setTimeout(()=>l(!1),1500))},d=n!=="------"?`${n.slice(0,3)} ${n.slice(3)}`:"------",g=(a.issuer||a.account_name||"A").charAt(0).toUpperCase();return e.jsxs("div",{role:"button",tabIndex:0,className:"group relative flex items-center justify-between p-3 rounded-xl hover:bg-[#1e2532] transition-colors cursor-pointer border border-transparent hover:border-white/5",onClick:s,onKeyDown:m=>m.key==="Enter"&&s(),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"shrink-0 w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center overflow-hidden shadow-sm",children:e.jsx("span",{className:"text-white font-bold text-base",children:g})}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-white font-semibold text-sm truncate",children:a.issuer||"Account"}),e.jsx("span",{className:"text-[#90a4cb] text-[11px] truncate",children:a.account_name||""})]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx("span",{className:`font-mono font-medium text-base tracking-wider transition-colors ${f?"text-red-400 animate-pulse":"text-white group-hover:text-[#256af4]"}`,children:d}),e.jsx("div",{className:"relative w-[22px] h-[22px] flex items-center justify-center",title:`${i}s`,children:e.jsxs("svg",{className:"transform -rotate-90 w-full h-full",viewBox:"0 0 22 22",children:[e.jsx("circle",{cx:"11",cy:"11",fill:"transparent",r:u,stroke:"#2d3748",strokeWidth:"2"}),e.jsx("circle",{className:"transition-all duration-1000",cx:"11",cy:"11",fill:"transparent",r:u,stroke:f?"#ef4444":"currentColor",strokeDasharray:p,strokeDashoffset:t,strokeLinecap:"round",strokeWidth:"2",style:{color:"#256af4"}})]})})]}),r&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#1e2532]/95 rounded-xl pointer-events-none border border-white/10",children:e.jsxs("span",{className:"text-[#256af4] font-medium text-xs flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"content_copy"}),x.copied]})})]})}T.createRoot(document.getElementById("root")).render(e.jsx(y.StrictMode,{children:e.jsx(E,{children:e.jsx(R,{})})}));
